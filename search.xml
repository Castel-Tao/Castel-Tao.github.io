<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>群体间遗传距离</title>
      <link href="/2020/06/25/qun-ti-jian-yi-chuan-ju-chi/"/>
      <url>/2020/06/25/qun-ti-jian-yi-chuan-ju-chi/</url>
      
        <content type="html"><![CDATA[<h3 id="01-Definition"><a href="#01-Definition" class="headerlink" title="01-Definition"></a><strong>01-Definition</strong></h3><h4 id="遗传距离"><a href="#遗传距离" class="headerlink" title="遗传距离"></a>遗传距离</h4><p>遗传距离是用来衡量物种之间或同一物种的群体之间的遗传差异（基因组差异）的程度，并且以某种数值进行度量。从本质上讲，遗传差异的任何数值测度，只要是在基因序列水平或是基因频率水平上，由不同个体、种群或种的数据计算而来，皆可定义为遗传距离<a href="#fn2">[2]</a>。</p><ul><li><h4 id="Identity-By-State-amp-Identity-By-Descent"><a href="#Identity-By-State-amp-Identity-By-Descent" class="headerlink" title="Identity By State &amp; Identity By Descent"></a>Identity By State &amp; Identity By Descent</h4></li></ul><p>A DNA segment is identical by state (IBS) in two or more individuals if they have identical nucleotide sequences in this segment. An IBS segment is identical by descent (IBD) in two or more individuals if they have inherited it from a common ancestor without recombination, that is, the segment has the same ancestral origin in these individuals<a href="#fn3">[3]</a>.</p><ul><li><h4 id="状态一致和同源一致"><a href="#状态一致和同源一致" class="headerlink" title="状态一致和同源一致"></a>状态一致和同源一致</h4></li></ul><p>在两个或两个以上的个体当中，如果一个 DNA 片段具有相同的核苷酸序列，就说这个 DNA 片段是状态一致（Identity By State, IBS），如果这个 IBS 片段是遗传自同一个祖先且中间过程没有发生过重组事件，就说这个片段是同源一致（Identity By Descent, IBD）。</p><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/2020.6/20200625001554.png" alt=""></p><p>IBD.png</p><hr><h4 id="02-Measures-of-Genetic-Distance"><a href="#02-Measures-of-Genetic-Distance" class="headerlink" title="02-Measures of Genetic Distance"></a><strong>02-Measures of Genetic Distance</strong></h4><hr><ul><li><h4 id="个体间遗传距离（Genetic-Distance-of-individuals）度量方法"><a href="#个体间遗传距离（Genetic-Distance-of-individuals）度量方法" class="headerlink" title="个体间遗传距离（Genetic Distance of individuals）度量方法"></a>个体间遗传距离（Genetic Distance of individuals）度量方法</h4></li></ul><p>目前，最为常用的个体间遗传距离的度量方法为<strong>共享等位基因差异（Allele Sharing Distance）</strong>，以及与之密切相关的计算指标<strong>状态一致性数量（dentity By State, IBS）或等位基因共享百分数（Proportion of Allele Sharing, ASP)</strong>。状态一致性数量是指在同一基因座（locus, loci）上，个体间拥有相同等位基因数量。等位基因共享百分比也可以称为等位基因共享类型是指在同一基因座上，个体间拥有相同等位基因的百分比（100%：完全共享，50%：部分共享，0：不共享）。</p><ul><li><h4 id="基于单个SNP位点理解两个个体之间遗传距离度量指标"><a href="#基于单个SNP位点理解两个个体之间遗传距离度量指标" class="headerlink" title="基于单个SNP位点理解两个个体之间遗传距离度量指标"></a>基于单个SNP位点理解两个个体之间遗传距离度量指标</h4></li></ul><p>对于一个二态性的（biallelic）SNP位点，通常有三种基因型：AA、Aa和aa。两个个体的基因型，个体间等位基因共享数量（状态一致数量），个体间等位基因共享类型（百分比）以及个体间遗传距离的数值测度见下表。</p><table><thead><tr><th>Individual 1</th><th>Individual 2</th><th>IBS</th><th>ASP</th><th>Genetic Distance</th></tr></thead><tbody><tr><td>AA</td><td>AA</td><td>2</td><td>100%</td><td>0</td></tr><tr><td>Aa</td><td>Aa</td><td>2</td><td>100%</td><td>0</td></tr><tr><td>aa</td><td>aa</td><td>2</td><td>100%</td><td>0</td></tr><tr><td>AA</td><td>Aa</td><td>1</td><td>50%</td><td>0.5</td></tr><tr><td>Aa</td><td>AA</td><td>1</td><td>50%</td><td>0.5</td></tr><tr><td>Aa</td><td>aa</td><td>1</td><td>50%</td><td>0.5</td></tr><tr><td>aa</td><td>Aa</td><td>1</td><td>50%</td><td>0.5</td></tr><tr><td>AA</td><td>aa</td><td>0</td><td>0</td><td>1</td></tr><tr><td>aa</td><td>AA</td><td>0</td><td>0</td><td>1</td></tr></tbody></table><ul><li><h4 id="多个多态位点计算两个个体之间平均遗传距离"><a href="#多个多态位点计算两个个体之间平均遗传距离" class="headerlink" title="多个多态位点计算两个个体之间平均遗传距离"></a>多个多态位点计算两个个体之间<em>平均遗传距离</em></h4></li></ul><p><img src="https:////upload-images.jianshu.io/upload_images/13346368-50ec524182e6872d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/123/format/webp" alt="img"></p><p>遗传距离公式.png</p><ul><li><p>其中</p><ul><li>L：个体间用于计算遗传距离的SNP位点数目；</li><li>dkij = 0 ：个体 i 和个体 j 在位点 k 上的基因型完全相同（AA|AA；或者Aa|Aa；或者aa|aa）；</li><li>dkij = 0.5 ：个体 i 和个体 j 在位点 k 上的基因型有一个等位基因相同（AA|Aa；或者aa|Aa）；</li><li>dkij = 1 ：个体 i 和个体 j 在位点 k 上的基因型完全不相同（AA|aa）。</li></ul></li><li><h4 id="多个个体构建遗传距离矩阵"><a href="#多个个体构建遗传距离矩阵" class="headerlink" title="多个个体构建遗传距离矩阵"></a>多个个体构建<em>遗传距离矩阵</em></h4></li></ul><table><thead><tr><th>Sample ID</th><th>Individual 1</th><th>Individual 2</th><th>Individual 3</th><th>Individual 4</th><th>……</th><th>Individual n</th></tr></thead><tbody><tr><td><strong>Individual 1</strong></td><td></td><td>0.3</td><td>0.4</td><td>0.5</td><td>…</td><td>0.5</td></tr><tr><td><strong>Individual 2</strong></td><td>0.3</td><td></td><td>0.4</td><td>0.5</td><td>…</td><td>0.6</td></tr><tr><td><strong>Individual 3</strong></td><td>0.4</td><td>0.4</td><td></td><td>0.8</td><td>…</td><td>0.7</td></tr><tr><td><strong>Individual 4</strong></td><td>0.5</td><td>0.5</td><td>0.8</td><td></td><td>…</td><td>0.6</td></tr><tr><td><strong>……</strong></td><td>…</td><td>…</td><td>…</td><td>…</td><td></td><td>0.7</td></tr><tr><td><strong>Individual n</strong></td><td>0.5</td><td>0.6</td><td>0.7</td><td>0.6</td><td>0.7</td><td></td></tr></tbody></table><ul><li><h4 id="利用-PLINK-v1-9-软件构建-IBS-矩阵"><a href="#利用-PLINK-v1-9-软件构建-IBS-矩阵" class="headerlink" title="利用 PLINK v1.9 软件构建 IBS 矩阵"></a>利用 PLINK v1.9 软件构建 IBS 矩阵</h4></li></ul><p><img src="https:////upload-images.jianshu.io/upload_images/13346368-9efaeb59de3c58b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/396/format/webp" alt="img"></p><p>IBS.png</p><ul><li>其中 <ul><li>L：个体间用于计算 IBS 的 SNP 位点总数；</li><li>IBS2：位点上共享 2 个等位基因；</li><li>IBS1：位点上共享 1 个等位基因。</li></ul></li></ul><pre class=" language-undefined"><code class="language-undefined">plink --file mydata --cluster --matrix</code></pre><ul><li><h4 id="利用-PLINK-v1-9-软件构建-IBS-距离矩阵"><a href="#利用-PLINK-v1-9-软件构建-IBS-距离矩阵" class="headerlink" title="利用 PLINK v1.9 软件构建 IBS 距离矩阵"></a>利用 PLINK v1.9 软件构建 IBS 距离矩阵</h4></li></ul><p>  DIBS = 1 - IBS</p><pre class=" language-swift"><code class="language-swift">plink <span class="token operator">--</span>file mydata <span class="token operator">--</span>cluster <span class="token operator">--</span><span class="token builtin">distance</span><span class="token operator">-</span>matrix</code></pre><hr><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><hr><ol><li>Nei, M., Genetic Distance, in Encyclopedia of Genetics, S. Brenner and J.H. Miller, Editors. 2001, Academic Press: New York. p. 828-832. <a href="#fnref1">↩</a></li><li>Worku, A. and Y. Tadesse, A Review on Population Structure, Genetic Diversity Analysis, Genetic Distance between Population and Genetic Singularity in Livestock. Advances in Life Science and Technology, 2017. 54: p. 1-6. <a href="#fnref2">↩</a></li><li>Povysil, G. and S. Hochreiter, Sharing of Very Short IBD Segments between Humans, Neandertals, and Denisovans. bioRxiv, 2014: p. 003988. <a href="#fnref3">↩</a></li></ol><p>作者：PETJO</p><p>链接：<a href="https://www.jianshu.com/p/d555dc28c3c0#fn2" target="_blank" rel="noopener">https://www.jianshu.com/p/d555dc28c3c0#fn2</a></p><p>来源：简书</p><p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><h3 id="1-群体遗传分化的度量"><a href="#1-群体遗传分化的度量" class="headerlink" title="1. 群体遗传分化的度量"></a>1. 群体遗传分化的度量</h3><h4 id="（1）F-统计量"><a href="#（1）F-统计量" class="headerlink" title="（1）F-统计量"></a>（1）F-统计量</h4><p>现实植物自然群体并非是理想群体，如果<strong>仅考虑单基因座上一对等位基因</strong>，对于由若干个地方群体组成的生物大群体，各层次现实群体中基因型频率期望值偏差一般用Fis、Fif、Fst三个参数来度量，统称为<strong>F-统计量</strong>。<br> FIS,是Hi相对于Hs减少量的比值，也就是地方群体平均近交系数。</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-1c47f9a75a9eea52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/338/format/webp" alt="img"></p><p>Fst，是Hs相对于Ht减少量的比值，可理解为有亲缘关系地方群体间的平均近交系数。</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-5a51b478eac1f34f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/358/format/webp" alt="img"></p><p> Fit，是Hi相对于Ht减少量的比值，也就是整个群体水平近交系数。</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-2eb57adebd254b7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/362/format/webp" alt="img"></p><p>image.png</p><p> 如果从配子间亲缘关系角度来分析，Fis和Fit分别相当于地方群体和整个群体中任何个体携带的一对等位基因是同源的概率，而Fst是从两个地方群体中任意抽取的两个配子是同源的概率。从两个地方群体中任意抽出的两个配子是同源的概率大，表明两个地方群体遗传组成相似，反之，地方群体间遗传分化程度高，因此，可用Fst度量地方群体间遗传分化。 </p><blockquote><p>Wright（1978）建议，实际研究中Fst为0 ~ 0.05，群体间遗传分化很小，可不考虑群体间遗传分化；Fst为0.05 ~ 0.15，群体间存在中等程度遗传分化；Fst为0.15 ~ 0.25，群体间遗传分化较大；Fst值在0.25以上，群体间有很大遗传分化。</p></blockquote><h4 id="（2）Nei’s-Gst"><a href="#（2）Nei’s-Gst" class="headerlink" title="（2）Nei’s Gst"></a>（2）Nei’s Gst</h4><p>F-统计量是针对一对等位基因提出的，如果基因座上存在复等位基因时，Nei（1973）定义了不用同源配子结合的相关性概念的基因差异分化系数（gene differentiation coefficient，Gst）。基因差异分化系数不必考虑地方群体形成历史、迁移方式、群体中等位基因数目和基因型频率，也不必考虑群体内是否存在选择，只需将整个群体中杂合体频率分解为地方群体间变异和地方群体内变异。所有的固定指数均可以由被调查的群体中杂合体频率观察值和期望值来定义。</p><h4 id="（3）等位基因频率方差"><a href="#（3）等位基因频率方差" class="headerlink" title="（3）等位基因频率方差"></a>（3）等位基因频率方差</h4><h3 id="2-遗传距离"><a href="#2-遗传距离" class="headerlink" title="2.遗传距离"></a>2.遗传距离</h3><p>量化群体间遗传分化程度的另一个参数是遗传距离（genetic distance），它常用群体中等位基因频率的函数来度量。最理想的遗传距离度量方法使遗传距离取值范围为[0,1]。0表示两个个体或群体中所有遗传标记都存在，1表示在两个个体或群体中没有共同的遗传标记。<br> 遗传距离应该是一个进化度量值，与进化趋异（evolutionary divergence）相关。进化上，两组个体分化越大，其遗传距离值就越大。</p><h4 id="（1）-Nei’s-Genetic-Distance"><a href="#（1）-Nei’s-Genetic-Distance" class="headerlink" title="（1） Nei’s Genetic Distance"></a>（1） Nei’s Genetic Distance</h4><p>假定X和Y是生物两个不同地方群体（假定地方群体为理想群体），<em>xi</em>、<em>yi</em>分别表示X群体和Y群体特定座位上第<em>i</em>个等位基因频率，那么：</p><p> 随机从X群体中抽取一对等位基因是同一（identical）的概率为 </p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-0c0ca512bc031255.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/162/format/webp" alt="img"></p><p> 随机从Y群体中抽取一对等位基因是同一的概率为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-ea269542c57ef6e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/163/format/webp" alt="img"></p><p> 分别从X和Y群体中各抽取一个等位基因是同一的概率为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-152094b0f6245e2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/200/format/webp" alt="img"></p><p>如果<em>m</em>为检测到的基因座数，<em>xij</em>、<em>yij</em>分别表示X群体和Y群体中第<em>j</em>个座位上第<em>i</em>个等位基因频率，<em>rj</em>表示第<em>j</em>个座位上等位基因数。<em>Jx</em>、<em>Jy</em>、<em>Jxy</em>分别为上述三种概率的算数平均值，那么</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-eeeca31df2a614e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/953/format/webp" alt="img"></p><p> 随机从X群体中抽取一对基因组间的不同等位基因的比例为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-403e7d8a56fe5c9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/160/format/webp" alt="img"></p><p> 随机从Y群体中抽取一对基因组间的不同等位基因的比例为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-8f1d4bd77fbec893.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/162/format/webp" alt="img"></p><p>分别从X和Y群体中各抽取一个基因组间的不同等位基因的比例为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-cda3aa8c1bd5a8a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/182/format/webp" alt="img"></p><p> Nei等证明，</p><p>Dx</p><p>、</p><p>Dy</p><p>分别表示X、Y群体中随机抽取基因组间的密码子差值的最小估计，而</p><p>Dxy</p><p>表示来自X、Y群体的两个基因组间密码子差值的最小估计，于是Nei’s最小遗传距离的计算式为</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-b4473f1310cb7704.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/425/format/webp" alt="img"></p><p> Nei’s最小遗传距离是由群体中等位基因频率直接确定群体间遗传距离，但各D值表示的是不同来源的基因组间不相同等位基因的比例，这种变异是不可加的。</p><p> 为克服这一缺点，将</p><p>Dm</p><p>进行标准化，称为Nei’s标准遗传距离</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-a633b40f77d07b04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/319/format/webp" alt="img"></p><h3 id="2-植物群体间迁移"><a href="#2-植物群体间迁移" class="headerlink" title="2. 植物群体间迁移"></a>2. 植物群体间迁移</h3><p>迁移（migration），是指具有某一地方群体中部分个体或配子，因某种原因传播至另一地方群体，并杂交定居。如果迁入和迁出群体的遗传结构不同，将改变迁入地方群体中等位基因频率，这种影响称为迁移压（migration pressure）。<br> 迁移称为地方群体遗传变异大来源。<br> 遗传漂移和自然选择是群体间差异增加，而迁移的遗传效应正好相反。等位基因横跨群体间障碍而慢慢扩散，造成迁入群体中等位基因频率逐渐改变，增加群体间遗传相似性。这种群体间基因流动，称为<strong>基因流（gene flow）</strong>。<br> 群体间迁移的遗传效应主要取决于群体遗传结构、迁移率、群体分布结构。<br> 植物群体分布结构：</p><p>（1） 陆岛模型 </p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-f0ac5e740695c30b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/477/format/webp" alt="img"></p><p>（2） 岛屿模型</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-e792835d1b327df9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/439/format/webp" alt="img"></p><p>（3） 距离隔离模型</p><h3 id="3-植物基因流"><a href="#3-植物基因流" class="headerlink" title="3. 植物基因流"></a>3. 植物基因流</h3><p>植物基因流，是借助花粉、种子、孢子、营养体等遗传物质携带者的迁移或运动来实现的。其中，种子扩散和花粉传播是植物基因流的最主要方式。植物基因流强弱不仅影响植物群体遗传变异水平和有效群体大小，而且也会造成群体遗传结构的重新分配。<br> 研究植物基因流，很大程度上是度量配子（主要是花粉）和种子在群体内和群体间的迁移方式和机制。<br> 植物基因流是研究植物群体动态和进化的一个中心问题，在植物群体片段化活力分析、转基因植物安全性分析、入侵植物的控制等方面具有重要意义。</p><p><img src="https:////upload-images.jianshu.io/upload_images/1719634-0d017b994acd747e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/947/format/webp" alt="img"></p><p>作者：WooWoods</p><p>链接：<a href="https://www.jianshu.com/p/91479ebefea7" target="_blank" rel="noopener">https://www.jianshu.com/p/91479ebefea7</a></p><p>来源：简书</p><p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>]]></content>
      
      
      
        <tags>
            
            <tag> genetics </tag>
            
            <tag> population genetics </tag>
            
            <tag> arithmetic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>群体间遗传分化度量值Fst</title>
      <link href="/2020/06/25/qun-ti-jian-fen-hua-du-liang-fst-zhi/"/>
      <url>/2020/06/25/qun-ti-jian-fen-hua-du-liang-fst-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="F-统计量、Fst和Gst"><a href="#F-统计量、Fst和Gst" class="headerlink" title="F-统计量、Fst和Gst"></a>F-统计量、Fst和Gst</h2><p><strong>遗传距离（Genetic distance）</strong>：又称“遗传差异”，指不同种群或物种之间的基因差异程度，并且以某种数值进行度量，通常用Fst值反映<strong>群体</strong>遗传变异的尺度。</p><p><strong>F-统计量</strong>是针对一对等位基因提出的，F统计量主要有（Fis，Fif，Fst）三种。</p><p>如果基因座上存在复等位基因时，Nei（1973）定义了不用同源配子结合的相关性概念的基因差异分化系数（gene differentiation coefficient，Gst）。</p><p><strong>Fst</strong>：群体间遗传分化指数，又称为固定系数。反映群体等位基因杂合性水平，用于衡量种群分化程度。群体遗传学中衡量群体间分化程度的指标有很多种，最常用的就是Fst指数。</p><p>这个值是种群分化和遗传距离的一种度量方法，<strong>分化指数越大，差异越大</strong>。适用于亚群体间多样性的比较。</p><p>Fst是针对一对等位基因，如果基因座上存在复等位基因，则需要用Gst衡量。</p><h2 id="Fst意义"><a href="#Fst意义" class="headerlink" title="Fst意义"></a>Fst意义</h2><p>Fst取值范围[0,1]，最大值为1，表明等位基因在各地方群体中固定，两个群体完全独立；最小值为0，意味着不同地方群体遗传结构完全一致，群体间没有分化，群体间自由interbreeding。</p><p>Wright（1978）建议，</p><p>Fst为0 ~ 0.05，群体间遗传分化很小，可不考虑群体间遗传分化；</p><p>Fst为0.05 ~ 0.15，群体间存在中等程度遗传分化；</p><p>Fst为0.15 ~ 0.25，群体间遗传分化较大；</p><p>Fst值在0.25以上，群体间有很大遗传分化。</p><h2 id="Fst应用"><a href="#Fst应用" class="headerlink" title="Fst应用"></a>Fst应用</h2><p>Fst可用于计算SNP位点在不同群体中的分化程度（或固定程度），野生种亚群和栽培种亚群间的Fst可反映维位点受人工选择程度。是一种以<strong>哈温平衡为前提</strong>的种群遗传学统计方法。</p><p>计算步骤如下：</p><ol><li><p>测定群体数目及群体规模</p></li><li><p>分别计算群体及亚群体中某一位点上的等位基因频率和基因型频率</p></li><li><p>计算种群期望杂合度（H<del>T</del>）和亚群预计杂合度（H<del>S</del>）</p></li><li><p>计算Fst</p></li></ol><h2 id="Fst的计算"><a href="#Fst的计算" class="headerlink" title="Fst的计算"></a>Fst的计算</h2><h3 id="杂合度的概念"><a href="#杂合度的概念" class="headerlink" title="杂合度的概念"></a>杂合度的概念</h3><p>要清晰明白上述过程，首先要理解杂合度这个概念：</p><p>设某群体中一对等位基因，a=0.5，A=0.5，Aa杂合度=0.5，最大；</p><p>若另一个群体中，a=0.4，A=0.6，则Aa杂合度=2 x 0.4 x 0.6 = 0.48，稍小了一些；</p><p>第三个群体，a=0.2，A=0.8，则Aa杂合度=2 x 0.2 x 0.8 = 0.32，更小。</p><p>由上可见，杂合度越小，种群越纯净；杂合度高，种群越不纯净。</p><h3 id="F-统计量计算公式"><a href="#F-统计量计算公式" class="headerlink" title="F-统计量计算公式"></a>F-统计量计算公式</h3><p>Fit：种群的总近交系数</p><p>Fst：群体内基因分化系数</p><p>Fis：种群内近交系数， FIS，是HI相对于HS减少量的比值，即地方群体的平均近交系数。</p><p>Hi：整个总体所观察到的杂合体频率平均值。（把所有亚群体当作一个总的整体来看的时候）</p><p>Hs：几个亚群体的期望杂合度的平均值。</p><p>Ht：把所有亚群体当作一个总的整体来看的时候，这个总群体中的期望杂合度。且这个总的群体满足HW平衡(He).</p><p>Fis = (Hs - Hi)/Hs = 1-(Hi/Hs) ; FIS，是HI相对于HS减少量的比值，即地方群体的平均近交系数。</p><p>Fst = (Ht - Hs)/Ht = 1-(Hs/Ht) ; FST，是HS相对于HT减少量的比值，即有亲缘关系地方群体间的平均近交系数。</p><p>Fit = (Ht - Hi)/Ht = 1-(Hi/Ht) ; FIT，是HI相对于HT减少量的比值，即整个群体的平均近交系数。</p><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h3><p>理论上要估算FST，需要以下步骤：</p><ul><li>找出每个亚群的等位基因频率。</li><li>查找复合群体的平均等位基因频率</li><li>计算每个亚群的杂合度（2pq）</li><li>计算这些亚群杂合度的平均值，这是HS。</li><li>根据总体等位基因频率计算杂合度，这是HT。</li><li>最后，计算FST =（HT-HS）/ HT</li></ul><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/2020.6/20200621123429.png" alt=""></p><p>在得到每个群体中等位基因的频率后:</p><p>首先第一步是计算每个亚群的杂合度H，这一步简单H=2<em>p</em>q （p和q是对应群体中等位基因的频率）</p><p>第二步计算这些亚群杂合度的平均值HS，取三个不同种群中的H值，除去平均数3，得到结果</p><p>第三步，计算群体等位基因频率，和上述方法类似，取每个等位基因在对应种群中的频率叠加除去平均数。</p><p>第四步，计算所有群体中的杂合度HT，使用2pq，p和q是群体中的等位基因频率，在第三步骤已经算好了。</p><p>最后，根据计算公式算出Fst。</p><p>在实际中，当然不可能用手工对每个位点进行这样的计算，怎样在电脑中分析FST等值？</p><h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><p>当然了，实际中我们并不需要像上述例子那样逐个计算。等位基因频率的信息都藏在snp calling后的vcf中，再使用恰当的工具就可以快速计算出Fst。下面给大家介绍一种比较popular的计算Fst的方法（还有其他方法不限于一种），使用vcftools：</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">##对每一个SNP变异位点进行计算</span>vcftools --vcf test.vcf --weir-fst-pop 1_population.txt --weir-fst-pop 2_population.txt  --out p_1_2—single<span class="token comment" spellcheck="true">##按照区域来计算</span>vcftools --vcf test.vcf --weir-fst-pop 1_population.txt --weir-fst-pop 2_population.txt  --out p_1_2_bin --fst-window-size 500000 --fst-window-step 50000<span class="token comment" spellcheck="true"># test.vcf是SNP calling 过滤后生成的vcf 文件；</span><span class="token comment" spellcheck="true"># p_1_2_3 生成结果的prefix</span><span class="token comment" spellcheck="true"># 1_population.txt是一个文件包含同一个群体中所有个体，一般每行一个个体。个体名字要和vcf的名字对应。</span><span class="token comment" spellcheck="true"># 2_population.txt 包含了群体二中所有个体。</span><span class="token comment" spellcheck="true">#计算的窗口是500kb，而步长是50kb （根据你的需其可以作出调整）。我们也可以只计算每个点的Fst，去掉参数（--fst-window-size 500000 --fst-window-step 50000）即可。</span></code></pre><p>分别对不同结果进行图形绘制</p><pre class=" language-R"><code class="language-R">##图1library(ggplot2)data<-read.table("test1.out.windowed.weir.fst",header=T)sc3 = subset(data,CHROM=="Gm01")p <- ggplot(sc3,aes(x=BIN_END/1000000,y=WEIGHTED_FST)) + geom_point(size=0.5, colour="blue") + xlab("Physical distance (Mb)")+ ylab("Fst") + ylim(-1,1)p + theme_bw()##图2library(ggplot2)data<-read.table("test.out.weir.fst",header=T)sc3 = subset(data,CHROM=="Gm01")p <- ggplot(sc3,aes(x=POS,y=WEIR_AND_COCKERHAM_FST)) + geom_point(size=0.5, colour="blue") + xlab("Physical distance (Mb)")+ ylab("Fst") + ylim(-1,1)p + theme_bw()</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/2020.6/20200625000105.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/2020.6/20200625000111.png" alt=""></p><p>可以看到两幅图还是基本对应的，然后对一些接近1，与大部分点偏离比较高的点可以将其与功能注释相结合，还有一些选择压力分析的工具相结合，寻找出其对应的基因，观察该基因是否是被选择。Pi也是选择分析中一个很要的参数，这一部分内容有时间这一点以后再补回来。</p><h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h3><table><thead><tr><th></th><th>AA</th><th>Aa</th><th>aa</th></tr></thead><tbody><tr><td>种群1</td><td>125</td><td>250</td><td>125</td></tr><tr><td>种群2</td><td>50</td><td>30</td><td>20</td></tr><tr><td>种群3</td><td>100</td><td>500</td><td>400</td></tr></tbody></table><p>表格表示为三个种群中一个等位基因的存在情况。</p><p>第一步，计算种群大小：</p><p>种群1: 500</p><p>种群2: 100</p><p>种群3: 1000</p><p>第二步，计算等位基因的频率：</p><p>p1=(125*2+250)/1000=0.5</p><p>q1=1-p1=0.5</p><p>p2=(50*2+30)/200=0.65</p><p>q2=1-p2=0.35</p><p>p3=(100*2+500)/200=0.35</p><p>q3=1-p3=0.65</p><p>第三步，计算哈温平衡下预期基因型：</p><p>种群1: E(AA)=500<em>0.5</em>0.5=125(与实际相等)</p><p>E(Aa)=500<em>0.5</em>0.5*2=250(与实际相等)</p><p>E(aa)=500<em>0.5</em>0.5=125(与实际相等)</p><p>种群2： E(AA)=100<em>0.65</em>0.65=42.25(比实际小7.75)</p><p>E(Aa)=100<em>0.65</em>0.35*2=45.5(比实际多15.5)</p><p>E(aa)=100<em>0.35</em>0.35=12.25(比实际小7.75)</p><p>种群3: E(AA)=1000<em>0.35</em>0.35=122.5(比实际多22.5)</p><p>E(Aa)=1000<em>0.35</em>0.65*2=455(比实际小45)</p><p>E(aa)=1000<em>0.65</em>0.65=422.5(比实际多22.5)</p><p>种群1的 预期=实际，完美适合；</p><p>种群2的 预期比实际少15.5个纯合子，也可以理解为实际比预期多15.5个纯合子，可能是近交导致；</p><p>种群3的 预期比实际多45个纯合子，也可以理解为实际和预期相比有45个纯合子缺失，可能是远交或Wahlund效应导致。</p><p>第四步，计算每个亚群实际观察到的杂合度：</p><p>种群1: 250/500=0.5</p><p>种群2: 30/100=0.3</p><p>种群3: 500/1000=0.5</p><p>第五步，计算每个亚群预期的杂合度：</p><p>第六步，计算每个亚群的近交系数：</p><p>F1=(0.5-0.5)/0.5=0 不近交，不远交</p><p>F2=(0.455-0.3)/0.455=0.341 存在近交情况，实际杂合子比预期的少</p><p>F3=(0.455-0.5)/0.455=-0.099 存在远交情况，实际杂合子比预期的多</p><p>第七步，计算在整个种群中等位基因A的频率：</p><p>第八步，计算在整个种群中等位基因a的频率：</p><p>第九步，计算三种杂合性指数：</p><p>HI(实际杂合度)</p><p>HS(亚群预计杂合度–通过每个亚群预计杂合度(亚群等位基因频率)来计算)</p><p>HT(种群预计杂合度–通过种群中预计等位基因频率来计算)</p><p>第十步，计算:</p><p>最后留两个思考题：</p><p>1，FIS 和 FIT 的如何理解？</p><p>2，FST一定为正么？</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://www.voidcn.com/article/p-mdkdczqg-bpz.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-mdkdczqg-bpz.html</a></p><p><a href="https://wenku.baidu.com/view/b19155ef70fe910ef12d2af90242a8956aecaa36.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/b19155ef70fe910ef12d2af90242a8956aecaa36.html</a></p><p><a href="https://www.jianshu.com/p/b73a8d6233be" target="_blank" rel="noopener">https://www.jianshu.com/p/b73a8d6233be</a></p><p><a href="https://www.plob.org/article/21678.html" target="_blank" rel="noopener">https://www.plob.org/article/21678.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/44307625" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/44307625</a></p><p><a href="http://www.360doc.com/content/18/0221/13/19913717_731200680.shtml" target="_blank" rel="noopener">http://www.360doc.com/content/18/0221/13/19913717_731200680.shtml</a></p><p><a href="http://blog.sina.com.cn/s/blog_4ab0b3390102viol.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_4ab0b3390102viol.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> genetics </tag>
            
            <tag> population genetics </tag>
            
            <tag> arithmetic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AMOVA相关</title>
      <link href="/2020/06/18/amova-xiang-guan/"/>
      <url>/2020/06/18/amova-xiang-guan/</url>
      
        <content type="html"><![CDATA[<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><h4 id="参数方法和非参数方法"><a href="#参数方法和非参数方法" class="headerlink" title="参数方法和非参数方法"></a>参数方法和非参数方法</h4><p>在一个<a href="https://baike.baidu.com/item/%E7%BB%9F%E8%AE%A1%E6%8E%A8%E6%96%AD/1507361" target="_blank" rel="noopener">统计推断</a>问题中，如果总体分布的具体形式已知(最常见的是假定为<a href="https://baike.baidu.com/item/%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83/829892" target="_blank" rel="noopener">正态分布</a>)，则我们只需对其中含有的若干个未知参数作出估计或进行某种形式的假设检验，这类推断方法称为<strong>参数方法</strong>。</p><p>但在许多实际问题中，我们对总体分布的形式往往所知甚少(如只能作出诸如连续型分布、关于均值对称等微弱的假定)，甚至一无所知。这时就需要使用不必(或很少)依赖于总体分布形式的统计推断方法，此类推断方法通常称为<strong>非参数方法</strong>(non-parametric method)。</p><p>在假设检验中，如果检验统计量是不依赖于总体的分布或参数(粗略地说，就是<a href="https://baike.baidu.com/item/%E6%A3%80%E9%AA%8C%E7%BB%9F%E8%AE%A1%E9%87%8F" target="_blank" rel="noopener">检验统计量</a>中不包含总体的参数或总体参数的<a href="https://baike.baidu.com/item/%E4%BC%B0%E8%AE%A1%E5%80%BC" target="_blank" rel="noopener">估计值</a>)的，则这种检验方法就称为<strong>非参数方法</strong>或<strong>非参数检验</strong>。与此对应的假设检验方法就可称为<strong>参数方法</strong>或<strong>参数检验</strong>。</p><p>非参数方法应用范围广，计算简便，适合处理小样本资料。但是，非参数方法与参数方法相比，灵敏性和精确度较差。</p><h4 id="基因型和单倍型："><a href="#基因型和单倍型：" class="headerlink" title="基因型和单倍型："></a>基因型和单倍型：</h4><p><strong>单倍型</strong>：是单倍体基因型的简称，在遗传学上是指在同一染色体上进行共同遗传的多个基因座上等位基因的组合；通俗的说法就是若干个决定同一性状的紧密连锁的基因构成的基因型。按照某一指定基因座上基因重组发生的数量，单倍型甚至可以指至少两个基因座或整个染色体。</p><p><img src="http://imgsrc.baidu.com/baike/pic/item/f7426d8d50a9c00cb21bba5b.jpg" alt="遗传育种几个概念------同源染色体，等位基因，基因组，单倍型"></p><p><strong>与基因型的区别</strong>：更进一步的讲，单倍型也是指一个<a href="http://baike.baidu.com/view/544134.htm" target="_blank" rel="noopener">染色单体</a>里面具有统计学关联性的一类<a href="http://baike.baidu.com/view/213537.htm" target="_blank" rel="noopener">单核苷酸多态性</a>（SNPs）。一个单倍型内的这类统计学关联性和等位基因的确认被认为是可以明确的识别所有其他多态区域。这些信息对于探查普通疾病的基因学非常有用，也被用于<a href="http://baike.baidu.com/view/141578.htm" target="_blank" rel="noopener">人类单倍体型图计划</a>（<a href="http://baike.baidu.com/view/406106.htm" target="_blank" rel="noopener">HapMap</a>）中。基因在一条染色体上的组合称单元型 (haplotype ，又称单倍型 ) ，在体细胞<strong>两条染色体上的组合</strong>称基因型，其表达的特异性别称表型。</p><h4 id="等位基因和非等位基因"><a href="#等位基因和非等位基因" class="headerlink" title="等位基因和非等位基因"></a>等位基因和非等位基因</h4><p><strong>等位基因</strong></p><p>等位基因（allele）：位于一对同源染色体的相同位置上<a href="http://baike.baidu.com/view/57913.htm" target="_blank" rel="noopener">控制</a>某一性状的不同形态的基因。不同的等位基因产生例如发色或血型等遗传特征的变化。等位基因控制相对性状的显隐性关系及遗传效应，可将等位基因区分为不同的类别。在个体中，等位基因的某个形式（显性的）可以比其他形式（隐性的）表达得多。</p><p>等位基因是一些占据染色体的基因座的可以复制的脱氧核糖核酸。大部分时候是脱氧核糖核酸列，有的时候也被用来形容非基因序列。英文原文为”allele”(由希腊文αλληλος而来，代表each other的意思)。</p><p><strong>复等位基因：</strong>基因如果存在多种等位基因的形式，这种现象就称为复等位基因（multiple allelism）。任何一个二倍体个体只存在复等位基中的二个不同的等位基因。  </p><p><strong>拟等位基因</strong>(pseudoalleles)：表型效应相似,功能密切相关,在染色体上的位置又紧密连锁的基因。它们象是等位基因,而实际不是等位基因。</p><p>当一个生物体带有一对完全相同的等位基因时,则该生物体就该基因而言是纯合的(homozygous)或可称<strong>纯种</strong>(true-breeding)；反之，如果一对等位基因不相同，则该生物体是杂合的(heterozygous)或可称<strong>杂种</strong>(hybrid)。等位基因各自编码<a href="http://baike.baidu.com/view/15472.htm" target="_blank" rel="noopener">蛋白质</a>产物，决定某一性状，并可因突变而失去功能。</p><p><strong>非等位基因</strong></p><p>非等位基因：同一个性状有多个非等位基因控制，每个基因对该性状都有影响。在玉米中，至少有50个不同位置的基因影响着叶绿素的形成。</p><p>依据非等位基因相互作用的性质可以将它们归纳为：</p><p>　　<strong>①互补基因</strong>。若干非等位基因只有同时存在时才出现某一性状，其中任何一个发生突变时都会导致同一突变型性状，这些基因称为互补基因。</p><p>　　<strong>②异位显性基因</strong>。影响同一性状的两个非等位基因在一起时，得以表现性状的基因称为异位显性基因或称上位基因。</p><p>　　<strong>③累加基因</strong>。对于同一性状的表型来讲，几个非等位基因中的每一个都只有部分的影响，这样的几个基因称为累加基因或多基因。在累加基因中每一个基因只有较小的一部分表型效应，所以又称为微效基因。相对于微效基因来讲，由单个基因决定某一性状的基因称为主效基因。</p><p>　　<strong>④修饰基因</strong>。本身具有或者没有任何表型效应，可是和另一突变基因同时存在便会影响另一基因的表现程度的基因。如果本身具有同一表型效应则和累加基因没有区别。</p><p>　　<strong>⑤抑制基因</strong>。一个基因发生突变后使另一突变基因的表型效应消失而恢复野生型表型，称前一基因为后一基因的抑制基因。如果前一基因本身具有表型效应则抑制基因和异位显性基因没有区别。</p><p>　　<strong>⑥调节基因</strong>。一个基因如果对另一个或几个基因具有阻遏作用或激活作用则称该基因为调节基因。调节基因通过对被调节的结构基因转录的控制而发挥作用。具有阻遏作用的调节基因不同于抑制基因，因为抑制基因作用于突变基因而且本身就是突变基因，调节基因则作用于野生型基因而且本身也是野生型基因。</p><p>　　<strong>⑦微效多基因</strong>。影响同一性状的基因为数较多，以致无法在杂交子代中明显地区分它们的类型，这些基因统称为微效多基因或称多基因。</p><p>　　<strong>⑧背景基因型</strong>。从理论上看，任何一个基因的作用都要受到同一细胞中其他基因的影响。除了人们正在研究的少数基因以外，其余的全部基因构成所谓的背景基因型或称残余基因型。</p><p>　　等位基因的相互作用 1932年H.J.马勒依据突变型基因与野生型等位基因的关系归纳为无效基因、亚效基因、超效基因、新效基因和反效基因。</p><p>　　<strong>①无效基因</strong>。不能产生野生型表型的、完全失去活性的突变型基因。一般的无效基因却能通过回复突变而成为野生型基因。</p><p>　　<strong>②亚效基因</strong>。表型效应在性质上相同于野生型，可是在程度上次于野生型的突变型基因。</p><p>　　<strong>③超效基因</strong>。表型效应超过野生型等位基因的突变型基因。</p><p>　　<strong>④新效基因</strong>。产生野生型等位基因所没有的新性状的突变型基因。</p><p>　　<strong>⑤反效基因</strong>。作用和野生型等位基因相对抗的突变型基因。</p><p>　　<strong>⑥镶嵌显性</strong>。对于某一性状来讲，一个等位基因影响身体的一个部分，另一等位基因则影响身体的另一部分，而在杂合体中两个部分都受到影响的现象称为镶嵌显性。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>随笔</title>
      <link href="/2020/06/11/sui-bi/"/>
      <url>/2020/06/11/sui-bi/</url>
      
        <content type="html"><![CDATA[<h2 id="就随便谢谢"><a href="#就随便谢谢" class="headerlink" title="就随便谢谢"></a>就随便谢谢</h2>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tabplot函数</title>
      <link href="/2020/06/11/tabplot-han-shu/"/>
      <url>/2020/06/11/tabplot-han-shu/</url>
      
        <content type="html"><![CDATA[<p>首先用devtools安装</p><p>然后运行：</p><pre class=" language-R"><code class="language-R">library(tabplot)diamonds %>% head()tableplot(diamonds)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot </tag>
            
            <tag> R </tag>
            
            <tag> data visualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apply族函数</title>
      <link href="/2020/06/11/apply-zu-han-shu/"/>
      <url>/2020/06/11/apply-zu-han-shu/</url>
      
        <content type="html"><![CDATA[<p>其实也没必要记住这么多，不会用了查就行**</p><p>lapply<br>|<br>|-&gt; 简化版: sapply<br>| | -&gt; 可设置返回值模板: vapply<br>| |-&gt; 多变量版: mapply<br>|<br>|-&gt; 递归版: rapply</p><h2 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h2><ol><li>3个参数，(data，margin，FUN)</li><li>应用在matrix或array上</li></ol><h2 id="sweep"><a href="#sweep" class="headerlink" title="sweep"></a>sweep</h2><p>常常和apply一起用，sweep函数和apply函数相似，但是sweep主要用于array的计算，而apply更多的是矩阵和data.frame计算。</p><pre class=" language-R"><code class="language-R">> mean.att <- apply(attitude, 2, mean) #对attitude每一col取均值> sweep(attitude, 2, mean.att, FUN = "-") %>% head() #让attitude每一个值减去这列均值，这就是两个参数了，一个值，一个列均值      rating complaints privileges   learning     raises   critical   advance1 -21.633333      -15.6 -23.133333 -17.366667  -3.633333  17.233333  2.0666672  -1.633333       -2.6  -2.133333  -2.366667  -1.633333  -1.766667  4.0666673   6.366667        3.4  14.866667  12.633333  11.366667  11.233333  5.0666674  -3.633333       -3.6  -8.133333  -9.366667 -10.633333   9.233333 -7.9333335  16.366667       11.4   2.866667   9.633333   6.366667   8.233333  4.0666676 -21.633333      -11.6  -4.133333 -12.366667 -10.633333 -25.766667 -8.933333</code></pre><h2 id="tapply和aggregate"><a href="#tapply和aggregate" class="headerlink" title="tapply和aggregate"></a>tapply和aggregate</h2><p>tapply函数很有用，tapply的功能就是把数据按照某种分组，在每个组内进行某个运算。这个aggregate函数很像。我觉得还是aggregate好用。</p><pre class=" language-R"><code class="language-R">> aggregate(mtcars,by=list(mtcars$cyl,mtcars$gear),FUN=mean)...略> aggregate(mtcars,by=list(mtcars$gear),FUN=mean)  Group.1      mpg      cyl     disp       hp     drat       wt   qsec        vs        am1       3 16.10667 7.466667 326.3000 176.1333 3.132667 3.892600 17.692 0.2000000 0.00000002       4 24.53333 4.666667 123.0167  89.5000 4.043333 2.616667 18.965 0.8333333 0.66666673       5 21.38000 6.000000 202.4800 195.6000 3.916000 2.632600 15.640 0.2000000 1.0000000  gear     carb1    3 2.6666672    4 2.3333333    5 4.400000> aggregate(mtcars$qsec,by=list(mtcars$gear),FUN=mean)  Group.1      x1       3 17.6922       4 18.9653       5 15.640> aggregate(cbind(mpg,hp) ~ cyl+gear, FUN=mean)  cyl gear    mpg       hp1   4    3 21.500  97.00002   6    3 19.750 107.50003   8    3 15.050 194.16674   4    4 26.925  76.00005   6    4 19.750 116.50006   4    5 28.200 102.00007   6    5 19.700 175.00008   8    5 15.400 299.5000> tapply(mtcars$qsec,mtcars$gear, mean)     3      4      5 17.692 18.965 15.640 </code></pre><p><strong>还可以实现crosstable功能，这个很好用</strong></p><pre class=" language-R"><code class="language-R">> df <- data.frame(year=kronecker(2001:2003, rep(1,4)),                   loc=c('beijing','beijing','shanghai','shanghai'),                   type=rep(c('A','B'),6), sale=rep(1:12))> tapply(df$sale, df[,c('year','loc')], sum)      locyear   beijing shanghai  2001       3        7  2002      11       15  2003      19       23# 类似的aggregate就麻烦一些> aggregate(df$sale, by = list(df$year,df$loc),FUN= sum) %>% +     reshape2::dcast(Group.1~Group.2)  Group.1 beijing shanghai1    2001       3        72    2002      11       153    2003      19       23</code></pre><h2 id="sapply和lapply"><a href="#sapply和lapply" class="headerlink" title="sapply和lapply"></a>sapply和lapply</h2><ol><li>都只有两个参数，第一个参数是输入数据，第二个是函数。</li><li>都应用在一个vector或list上</li><li>sapply返回的是一个vector，但是lapply返回的是一个list。其实sapply可以理解成lapply的简化版，s就是simplify的意思。</li></ol><p>其它：为了让sapply返回array或matrix，simplify参数很好用。</p><pre class=" language-R"><code class="language-R">   sapply(1:5,function(x) matrix(x,2,2), simplify = "array")</code></pre><p>这两个sapply/lapply 常和unlist()，matrix()，as.dataframe()，函数一起使用</p><h2 id="mapply"><a href="#mapply" class="headerlink" title="mapply"></a>mapply</h2><ol><li>多变量版的sapply，很好用，m就是multi的意思。</li><li>返回值是vector或matrix</li></ol><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200525153812.png" alt=""></p><p><strong>下面这段代码值得一看</strong></p><pre class=" language-R"><code class="language-R">Alco <- data.frame(AlcoholDrunk = c( "YES", "YES", "NO",  "YES", "YES", "YES", NA, "YES", "YES", "YES", "YES", "YES", "YES", "NO",  "NO",  "NO",  "NO", "YES"),                    AmountDrunk = c(3.0, 1.0,  NA ,3.0,  NA, 0.0,  NA, 0.0,  NA, 1.7,  NA,  NA, 0.0,  NA,  NA,  NA,  NA, 2.0))#这里AlcoholDrunk变量有三种类型的值，“YES”，表示有饮酒史；“NO”, 表示无饮酒史；NA, 表示数据不可获取。# alcohol函数实现的功能是：如果AlcoholDrunk是NA，直接返回NA，如果是NO，返回NO；否则返回AmountDrunk的数值。alcohol <- function(texVal, numVal){  if(is.na(texVal)) {return("NA")}  else if(texVal == "NO"){return("NO")}  else if(is.na(numVal)){return("amount Unknown")}  else {return(numVal)}}mapply(alcohol, Alco$AlcoholDrunk, Alco$AmountDrunk)  #两个变量</code></pre><h2 id="replicate"><a href="#replicate" class="headerlink" title="replicate"></a>replicate</h2><p>另外还有一个非常有用的函数<strong>replicate()</strong>，它可以将某个函数重复运行N次，常常用来生成较复杂的随机数。下面的例子即先建立一个函数，模拟扔两个骰子的点数之和，然后重复运行1000次。</p><pre class=" language-R"><code class="language-R"># 定义一个game函数game <- function() {n <- sample(1:6,2,replace=T) #这个sample()函数也挺有意思的，我想replicate()应该经常会和sample()连用return(sum(n))}replicate(n=1000,game())  #将game()函数重复运行1000次。</code></pre><h2 id="rapply"><a href="#rapply" class="headerlink" title="rapply"></a>rapply</h2><p>这个好像也非常有用</p><pre class=" language-R"><code class="language-R">rapply(list, FUN, classes="ANY", deflt=NULL, how=c("unlist", "replace", "list"), ...)</code></pre><p>rapply是递归版的lappy。基本原理是对list作遍历，如果其中有的元素仍然是list，则继续遍历；对于每个非list类型的元素，如果其类型是classes参数指定的类型之一，则调用FUN。classes=”ANY”表示匹配所有类型。</p><p>how参数用来指定操作方式，有三种：</p><p>a. “replace” 直接用调用FUN后的结果替换原list中原来的元素<br>b. “list” 新建一个list，元素类型在classes中的，调用FUN；不在classes中的类型，使用deflt。会保留原始list的结构。<br>c. “unlist” 相当于对”list”模式下的结果调用unlist(recursive=TRUE)</p><p><strong>看完下面的例子你就明白了</strong></p><pre class=" language-R"><code class="language-R">> lst <- list(a=list(aa=c(1:5), ab=c(0.1,0.2,0.25,0.3,0.33)),  #a list里两个元素+             b=list(ba=c(1:10)),   #b list里一个元素+             c=c('ha','m','k'))  #c 不是一个list； a,b,c共同构成了lst list> lst$a$a$aa[1] 1 2 3 4 5$a$ab[1] 0.10 0.20 0.25 0.30 0.33$b$b$ba [1]  1  2  3  4  5  6  7  8  9 10$c[1] "ha" "m"  "k" > rapply(lst, sum, how='list',classes = 'numeric')$a$a$aaNULL$a$ab[1] 1.18$b$b$baNULL$cNULL> rapply(lst, sum, how='unlist',classes = c('integer'))a.aa b.ba   15   55 > rapply(lst, sum, how='unlist',classes = c('integer','numeric')) a.aa  a.ab  b.ba 15.00  1.18 55.00 > rapply(lst, sum, how='unlist',classes = c('integer','numeric'),deflt="This is deflt")           a.aa            a.ab            b.ba               c            "15"          "1.18"            "55" "This is deflt" > rapply(lst, nchar, how='unlist',classes = "character", deflt="DEFLT")   a.aa    a.ab    b.ba      c1      c2      c3 "DEFLT" "DEFLT" "DEFLT"     "2"     "1"     "1" </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> data cleaning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用Figures</title>
      <link href="/2020/06/10/chang-yong-figures/"/>
      <url>/2020/06/10/chang-yong-figures/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1441226072&auto=1&height=66"></iframe><h2 id="How-to-output"><a href="#How-to-output" class="headerlink" title="How to output ?"></a>How to output ?</h2><pre class=" language-R"><code class="language-R"># 第一种png("./Figures/cor.all.png",width = 1350,height = 1350,units = "px")pndev.off()# 第二种ggsave("c:/Users/TAOTAO/Desktop/Taimu.mountain/Diff_Finger_radar.png",width = 380,height = 380,units = 'mm')# 第三种library(export)graph2pdf(x=x, file=filen, aspectr=2, font = "Arial",             height = 5, bg = "transparent")graph2ppt(x=x, file=filen, vector.graphic=FALSE, width=9,           aspectr=sqrt(2), append = TRUE)graph2png(file=filen, fun=plot.fun, dpi=400, height = 5, aspectr=4)</code></pre><h2 id="Barplot"><a href="#Barplot" class="headerlink" title="Barplot"></a>Barplot</h2><pre class=" language-R"><code class="language-R">ggplot(cor.box,aes(x=project,y=value,fill=variable))+          geom_bar(stat = "identity",position = position_dodge(),width=0.7) +          geom_errorbar(aes(ymin=value-sd,ymax=value+sd),                        width=0.3, position=position_dodge(0.7))+ #bar֮??????          theme_bw() + scale_fill_npg() +           #scale_y_continuous(breaks = c(0,0.2,0.4,0.6,0.8,0.9,0.95,1.0),                   #  labels = c(0,0.2,0.4,0.6,0.8,0.9,0.95,1.0))+          geom_text(aes(label = round(cor.box$value,3)),vjust = 3,size=5,                    position = position_dodge(0.9))+          theme(axis.text = element_text(size =15),                axis.title = element_text(family ="Myriad",size=18),                legend.title = element_text(family ="Myriad",size=18,hjust = 0.5),                legend.text = element_text(size=15)                ) +          labs(x = "Projects", y = "Median Correlation of Log2 Intensity \n MCLI",                fill = "Sample")</code></pre><h2 id="Radar-plot"><a href="#Radar-plot" class="headerlink" title="Radar plot"></a>Radar plot</h2><pre class=" language-R"><code class="language-R">#Radar functioncoord_radar <- function (theta = "x", start = 0, direction = 1) {  theta <- match.arg(theta, c("x", "y"))r <- if (theta == "x")   "y"else "x"ggproto("CoordRadar", CoordPolar, theta = theta, r = r, start = start,         direction = sign(direction),        is_linear = function(coord) TRUE)}#names(hehe) <- c("organ","tea","tem_scaled")hehe %>%     ggplot(aes(x=organ, y=tem_scaled,group=tea, fill=tea,color=tea))+    geom_polygon(color="black",alpha=.1,size=0.5) +    geom_point(size=4,shape=21,alpha=.5)+    coord_radar() +    theme_bw() +    #facet_wrap(~variable,nrow=2) +    scale_fill_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    theme(        axis.title=element_text(size=30,face="plain",color="black"),        axis.text = element_text(size=24,face="plain",color="black",angle = myAngle),        panel.grid.major = element_line(color="grey80"),        axis.line = element_line(color="black"),        axis.ticks =  element_line(color="black"),        legend.text = element_text(size=24))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524140546.png" alt=""></p><h2 id="Boxplot"><a href="#Boxplot" class="headerlink" title="Boxplot"></a>Boxplot</h2><h3 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h3><pre class=" language-R"><code class="language-R">gg_data %>% ggplot(aes(x= diff, y= temperature, color= tea))+    geom_boxplot(size = 1.2) +     theme_bw() +  my.theme +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    labs(title = "Temperature Difference of Finger Front ")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141112.png" alt=""></p><h3 id="云雨图"><a href="#云雨图" class="headerlink" title="云雨图"></a>云雨图</h3><pre class=" language-R"><code class="language-R">library(ggplot2)library(dplyr)"%||%" <- function(a, b) {  if (!is.null(a)) a else b}geom_flat_violin <- function(mapping = NULL, data = NULL, stat = "ydensity",                        position = "dodge", trim = TRUE, scale = "area",                        show.legend = NA, inherit.aes = TRUE, ...) {  layer(    data = data,    mapping = mapping,    stat = stat,    geom = GeomFlatViolin,    position = position,    show.legend = show.legend,    inherit.aes = inherit.aes,    params = list(      trim = trim,      scale = scale,      ...    )  )}#' @rdname ggplot2-ggproto#' @format NULL#' @usage NULL#' @exportGeomFlatViolin <-  ggproto("GeomFlatViolin", Geom,          setup_data = function(data, params) {            data$width <- data$width %||%              params$width %||% (resolution(data$x, FALSE) * 0.9)            # ymin, ymax, xmin, and xmax define the bounding rectangle for each group            data %>%              group_by(group) %>%              mutate(ymin = min(y),                     ymax = max(y),                     xmin = x,                     xmax = x + width / 2)          },          draw_group = function(data, panel_scales, coord) {            # Find the points for the line to go all the way around            data <- transform(data, xminv = x,                              xmaxv = x + violinwidth * (xmax - x))            # Make sure it's sorted properly to draw the outline            newdata <- rbind(plyr::arrange(transform(data, x = xminv), y),                             plyr::arrange(transform(data, x = xmaxv), -y))            # Close the polygon: set first and last point the same            # Needed for coord_polar and such            newdata <- rbind(newdata, newdata[1,])            ggplot2:::ggname("geom_flat_violin", GeomPolygon$draw_panel(newdata, panel_scales, coord))          },          draw_key = draw_key_polygon,          default_aes = aes(weight = 1, colour = "grey20", fill = "white", size = 0.5,                            alpha = NA, linetype = "solid"),          required_aes = c("x", "y"))#gg_data %>% dplyr::filter(diff == "F5-F4") %>% ggplot(aes(x= tea, y= temperature, fill=tea,color=tea))+    geom_flat_violin(position= position_nudge(x=.25)) +     geom_jitter(width = .1 )+    geom_boxplot(width = .1, position= position_nudge(x=.25), fill="white",size=.5,color="black") +     theme_bw() +  my.theme +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    scale_fill_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    labs(title = "Temperature Difference of Finger F5-F4 ")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524140914.png" alt=""></p><h2 id="Lineplot"><a href="#Lineplot" class="headerlink" title="Lineplot"></a>Lineplot</h2><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144155.png" alt="">****</p><pre class=" language-R"><code class="language-R">gg_data_1 <- read_csv("c:/Users/TAOTAO/Desktop/R.Code/Always/LinePlot.csv")gg_data_1 %>%             ggplot(aes(y=tem_scaled,x=part, color=tea, shape=tea))+                geom_point(size = 4,alpha=.8) +                 theme_bw() +                 scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +        geom_line(data=gg_data_1[which(gg_data_1$group_1=="R"),],                 aes(group=factor(JingLuo), linetype= factor(Jingluo)), size=1.4,alpha = .6) +      geom_line(data=gg_data_1[which(gg_data_1$group_1=="L"),],                 aes(group=factor(JingLuo), linetype= factor(Jingluo)), size=1.4,alpha = .6) </code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141154.png" alt=""></p><pre class=" language-R"><code class="language-R">hehe %>%  ggplot(aes(x=number,y=value,color=variable)) +   geom_line(lwd=2) +  #,linetype = "dashed"  theme_bw() + scale_color_npg() +  scale_x_continuous(breaks = POG.df$number,labels = POG.df$gene.rank)+  scale_y_continuous(breaks = c(0.2,0.4,0.6,0.7,0.8,0.85,0.9,0.95),                     labels = c(0.2,0.4,0.6,0.7,0.8,0.85,0.9,0.95))+  theme(axis.text.x = element_text(angle = 30,vjust = 0.4))+  xlab("Gene ranking")+  ylab("Percentage of Overlapped Genes")  #geom_point(position = position_dodge(.2), size = 2)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141236.png" alt=""></p><pre class=" language-R"><code class="language-R">tmp %>% dplyr::filter(type=="A") %>% ggplot(aes(x = variable,y=value,fill=Percentile,color=Date)) +   geom_line(lwd=3) +   ylab("Mean Covrage")+  xlab("Normalized Position")+  theme_bw() + scale_color_nejm() +  theme(axis.title = element_text(size=25),        axis.text = element_text(size =25),        legend.text = element_text(size=20), #图例文字        legend.title = element_text(size=25,hjust = 0.5))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141303.png" alt=""></p><h2 id="Scatter-plot"><a href="#Scatter-plot" class="headerlink" title="Scatter plot"></a>Scatter plot</h2><p>相关性矩阵图</p><pre class=" language-R"><code class="language-R">HEHE2 %>% pheatmap(show_rownames = T,           show_colnames = T,          cluster_rows = F,          cluster_cols = F,           display_numbers = TRUE,  #是否显示格子数值           number_color = "grey29",  #格子数值颜色           cutree_rows = 1,           cutree_cols = 1,           cellwidth = 45, cellheight = 45,           #annotation_col = col_anno,           #annotation_colors = ann_colors,          #annotation_row = col_anno,           border_color = F,   #调整格子边缘           main = paste0("Correlation Matrix of all Sample"),      #标题           fontsize=15                   #标题size           )</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144202.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144533.png" alt=""></p><h2 id="Paired-Scatter-Plot"><a href="#Paired-Scatter-Plot" class="headerlink" title="Paired Scatter Plot"></a>Paired Scatter Plot</h2><pre class=" language-R"><code class="language-R">library(GGally)panel.points <- function(data, mapping){  ggplot(data = data, mapping = mapping) +    geom_point(alpha=0.4,size=1.3,color='#177cb0')+ #3C5488FF    geom_abline(intercept = 0 , slope = 1 , color='#c93756', linetype='dashed', size=1)    #scale_x_continuous(limits=c(-7,17))+    #scale_y_continuous(limits=c(-7,17))}pn <- ggpairs(tmp2[7:ncol(tmp2)],mapping = ggplot2::aes(),  #title = paste0("Paired Scatter plot; ",i,"; ",format," 3000 genes"),  lower = list(continuous = panel.points),  #diag = list(continuous='barDiag'),  upper = list(    continuous = function(data, mapping, ...){    ggally_cor(data = data, mapping = mapping, size= 10)}    ) ) +  theme_light() +  theme(legend.position = "none",         panel.grid.major = element_blank(),         axis.ticks = element_blank(),         strip.text = element_text(size =20), #调节小面标签大小        axis.text = element_text(size =15), #调节坐标轴字体大小        panel.border = element_rect(colour = "black", fill = NA))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144046.png" alt=""></p><h2 id="Density-plot"><a href="#Density-plot" class="headerlink" title="Density plot"></a>Density plot</h2><pre class=" language-R"><code class="language-R">tmptmp %>%     ggplot(aes(x=value,fill=Sample_library,color=Sample_library)) +       geom_density(alpha=0.3,size=1.2) +       theme_bw() + scale_fill_nejm() + scale_color_nejm()+        labs(title = "Globle gene expression level",x= "log2 TPM")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144111.png" alt=""></p><h2 id="VeenDiagram"><a href="#VeenDiagram" class="headerlink" title="VeenDiagram"></a>VeenDiagram</h2><pre class=" language-R"><code class="language-R">library (VennDiagram)venn.diagram(x=list(AGR=top2000.AGR, NVS=top2000.NVS,WuXi=top2000.WuX_Poly,ARD=top2000.ARD_Poly),                "NT_Consensus_Diff_Platform.png", height = 2000, width = 2000,                resolution =900, imagetype="png",col="gray",               fill=c("#574266","#bddd22","#ff2d51","#3eede7"),                alpha=c(0.6, 0.6,0.6,0.6), lwd=0.5, cex=0.4, #lwd调节线条宽度,cex=0了文字就没有了，                                                                      #cex调节里面的标注大小               cat.dist=c(-0.07, -0.07, -0.05,-0.07),                cat.pos=c(100, 260, 0,150),cat.cex=0.45, cat.col="black", #cat.调节数据集名称，                                                                     #cat.col和.pos似乎也可有可无               rotation.degree=180)    #rotation.degree是旋转角度的意思，可有可无</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144105.png" alt=""></p><h2 id="PCA"><a href="#PCA" class="headerlink" title="PCA"></a>PCA</h2><pre class=" language-R"><code class="language-R"># PCA ---------------------------------------------------------------------tmp %>% tail()tmp2 <- tmp %>% dcast(gene~Single_ID) tmp2 %>% dim()#然后PCA作图展示结果pc.cr <- prcomp(t(log2(tmp2[,-1] + 0.01)),retx = TRUE)pc <- round(summary(pc.cr)$importance[2,],2) pca.result <- as.data.frame(pc.cr$x[,1:2])tmp1 <- tmp %>% dplyr::select(Single_ID,sample,library,year,project)hehe <- tmp1 %>% group_by(Single_ID,library,sample,project) %>% summarise() %>% as.data.frame()pca.result <- cbind(hehe,pca.result)pca.result %>% head()##PCA按照样本类型，建库策略分开pn <- ggplot(pca.result,aes(x=PC1,y=PC2,color=sample,shape=library))+      geom_point(size = 6,alpha=0.5) +       theme_bw() + scale_color_nejm() +      xlab(paste0("PC1  ",pc[1])) +      ylab(paste0("PC2  ",pc[2])) ### 3D pcalibrary(rgl)pca.result.3d <- as.data.frame(pc.cr$x[,1:3])pca.result.3d <- cbind(hehe,pca.result.3d)pca.result.3d %>% headscales::show_col(pal_nejm("default")(8))pca.result.3d$color <- "#BC3C29FF"pca.result.3d$color[pca.result.3d$sample == "B"] <- "#0072B5FF"pca.result.3d$color[pca.result.3d$library == "PolyA"] <- "#E18727FF"pca.result.3d$color[pca.result.3d$library == "Ribo"] <- "#20854EFF"within(pca.result.3d,plot3d(PC1,PC2,PC3,size=10,col = color))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144134.png" alt=""></p><h2 id="HCA"><a href="#HCA" class="headerlink" title="HCA"></a>HCA</h2><pre class=" language-R"><code class="language-R">sample[sample == "A"] <- "#BC3C29FF"  #红sample[sample == "B"] <- "#0072B5FF"library[library == "Ribo"] <- "#E18727FF"   #黄library[library == "PolyA"] <- "#20854EFF"  #绿color <-  data.frame(library,sample) %>% as.matrix()myclust <- function(x){hclust(x,method="average")}library("gplots")library("heatmap.plus")showpanel <- function(col){  image(z=matrix(1:100, ncol=1), col=col, xaxt="n", yaxt="n" )}showpanel(colorpanel(25,"#BC3C29FF","white","#0072B5FF"))heatmap.plus(as.matrix(center), col=colorpanel(15,"#0072B5FF","white","#BC3C29FF"),             labRow=F,labCol = F,             scale="none", hclustfun=myclust, ColSideColors=color,          key=F, symkey=FALSE, dendrogram=c("none"),          density.info="none", trace="none", cexRow=0.5)library(export)graph2png(file="hehe.png",width=7,height=7)require(graphics)hc <- hclust(dist(t(as.matrix(center))),"average")plot(hc,axes = F)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144116.png" alt=""></p><h2 id="火山图"><a href="#火山图" class="headerlink" title="火山图"></a>火山图</h2><pre class=" language-R"><code class="language-R"># 设置pvalue和logFC的阈值cut_off_pvalue = 0.05cut_off_logFC = 1# 根据阈值分别为上调基因设置‘up’，下调基因设置‘Down’，无差异设置‘Stable’，保存到change列data$change = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= cut_off_logFC,                      ifelse(data$log2.fc.> cut_off_logFC ,'Up','Down'),'Stable')# 作图data %>% ggplot(aes(x= log2.fc. ,y=-log10(qvalue),color = change)) +  geom_point(aes(size = Abundance),alpha = 0.5 ) +   labs(x = "log2 fold change", y = "-log10(qvalue) \n") +    xlim(-4,4) + ylim(0,8) +           geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8) +    geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8) +  theme_classic() +   scale_color_manual(values=c("#546de5", "#d2dae2","#ff4757"))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144832.png" alt=""></p><h2 id="火山图2"><a href="#火山图2" class="headerlink" title="火山图2"></a>火山图2</h2><pre class=" language-R"><code class="language-R">data <- read.csv( "C:../asset/wuli.csv")data$Abundance <- (data$Y179.30 + data$Y179.40)/1000# 设置pvalue和logFC的阈值cut_off_pvalue = 0.05cut_off_logFC = 1# 根据阈值分别为上调基因设置‘up’，下调基因设置‘Down’，无差异设置‘Stable’，保存到change列data$change = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= cut_off_logFC,                      ifelse(data$log2.fc.> cut_off_logFC ,'Up','Down'),'Stable')# 作图pn <- data %>% ggplot(aes(x= log2.fc. ,y=-log10(qvalue),color = change)) +  geom_point(aes(size = Abundance),alpha = 0.5 ) +   labs(x = "log2 fold change", y = "-log10(qvalue) \n") +    xlim(-4,4) + ylim(0,8) +           geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8) +    geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8) +  theme_classic() +   scale_color_manual(values=c("#546de5", "#d2dae2","#ff4757"))# 标记labeldata$label = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= 2.5,                        as.character(data$Geneid),"")library(ggrepel)pn + geom_text_repel(data = data, aes(x = data$log2.fc.,                                       y = -log10(data$qvalue),                                       label = label),                  size = 3,box.padding = unit(0.5, "lines"),                  point.padding = unit(0.8, "lines"),                   segment.color = "black",                   show.legend = FALSE)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200531165613.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/06/10/hello-world/"/>
      <url>/2020/06/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
