<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>常用Figures</title>
      <link href="/2020/06/10/chang-yong-figures/"/>
      <url>/2020/06/10/chang-yong-figures/</url>
      
        <content type="html"><![CDATA[<h2 id="How-to-output"><a href="#How-to-output" class="headerlink" title="How to output ?"></a>How to output ?</h2><pre class=" language-R"><code class="language-R"># 第一种png("./Figures/cor.all.png",width = 1350,height = 1350,units = "px")pndev.off()# 第二种ggsave("c:/Users/TAOTAO/Desktop/Taimu.mountain/Diff_Finger_radar.png",width = 380,height = 380,units = 'mm')# 第三种library(export)graph2pdf(x=x, file=filen, aspectr=2, font = "Arial",             height = 5, bg = "transparent")graph2ppt(x=x, file=filen, vector.graphic=FALSE, width=9,           aspectr=sqrt(2), append = TRUE)graph2png(file=filen, fun=plot.fun, dpi=400, height = 5, aspectr=4)</code></pre><h2 id="Barplot"><a href="#Barplot" class="headerlink" title="Barplot"></a>Barplot</h2><pre class=" language-R"><code class="language-R">ggplot(cor.box,aes(x=project,y=value,fill=variable))+          geom_bar(stat = "identity",position = position_dodge(),width=0.7) +          geom_errorbar(aes(ymin=value-sd,ymax=value+sd),                        width=0.3, position=position_dodge(0.7))+ #bar֮??????          theme_bw() + scale_fill_npg() +           #scale_y_continuous(breaks = c(0,0.2,0.4,0.6,0.8,0.9,0.95,1.0),                   #  labels = c(0,0.2,0.4,0.6,0.8,0.9,0.95,1.0))+          geom_text(aes(label = round(cor.box$value,3)),vjust = 3,size=5,                    position = position_dodge(0.9))+          theme(axis.text = element_text(size =15),                axis.title = element_text(family ="Myriad",size=18),                legend.title = element_text(family ="Myriad",size=18,hjust = 0.5),                legend.text = element_text(size=15)                ) +          labs(x = "Projects", y = "Median Correlation of Log2 Intensity \n MCLI",                fill = "Sample")</code></pre><h2 id="Radar-plot"><a href="#Radar-plot" class="headerlink" title="Radar plot"></a>Radar plot</h2><pre class=" language-R"><code class="language-R">#Radar functioncoord_radar <- function (theta = "x", start = 0, direction = 1) {  theta <- match.arg(theta, c("x", "y"))r <- if (theta == "x")   "y"else "x"ggproto("CoordRadar", CoordPolar, theta = theta, r = r, start = start,         direction = sign(direction),        is_linear = function(coord) TRUE)}#names(hehe) <- c("organ","tea","tem_scaled")hehe %>%     ggplot(aes(x=organ, y=tem_scaled,group=tea, fill=tea,color=tea))+    geom_polygon(color="black",alpha=.1,size=0.5) +    geom_point(size=4,shape=21,alpha=.5)+    coord_radar() +    theme_bw() +    #facet_wrap(~variable,nrow=2) +    scale_fill_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    theme(        axis.title=element_text(size=30,face="plain",color="black"),        axis.text = element_text(size=24,face="plain",color="black",angle = myAngle),        panel.grid.major = element_line(color="grey80"),        axis.line = element_line(color="black"),        axis.ticks =  element_line(color="black"),        legend.text = element_text(size=24))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524140546.png" alt=""></p><h2 id="Boxplot"><a href="#Boxplot" class="headerlink" title="Boxplot"></a>Boxplot</h2><h3 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h3><pre class=" language-R"><code class="language-R">gg_data %>% ggplot(aes(x= diff, y= temperature, color= tea))+    geom_boxplot(size = 1.2) +     theme_bw() +  my.theme +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    labs(title = "Temperature Difference of Finger Front ")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141112.png" alt=""></p><h3 id="云雨图"><a href="#云雨图" class="headerlink" title="云雨图"></a>云雨图</h3><pre class=" language-R"><code class="language-R">library(ggplot2)library(dplyr)"%||%" <- function(a, b) {  if (!is.null(a)) a else b}geom_flat_violin <- function(mapping = NULL, data = NULL, stat = "ydensity",                        position = "dodge", trim = TRUE, scale = "area",                        show.legend = NA, inherit.aes = TRUE, ...) {  layer(    data = data,    mapping = mapping,    stat = stat,    geom = GeomFlatViolin,    position = position,    show.legend = show.legend,    inherit.aes = inherit.aes,    params = list(      trim = trim,      scale = scale,      ...    )  )}#' @rdname ggplot2-ggproto#' @format NULL#' @usage NULL#' @exportGeomFlatViolin <-  ggproto("GeomFlatViolin", Geom,          setup_data = function(data, params) {            data$width <- data$width %||%              params$width %||% (resolution(data$x, FALSE) * 0.9)            # ymin, ymax, xmin, and xmax define the bounding rectangle for each group            data %>%              group_by(group) %>%              mutate(ymin = min(y),                     ymax = max(y),                     xmin = x,                     xmax = x + width / 2)          },          draw_group = function(data, panel_scales, coord) {            # Find the points for the line to go all the way around            data <- transform(data, xminv = x,                              xmaxv = x + violinwidth * (xmax - x))            # Make sure it's sorted properly to draw the outline            newdata <- rbind(plyr::arrange(transform(data, x = xminv), y),                             plyr::arrange(transform(data, x = xmaxv), -y))            # Close the polygon: set first and last point the same            # Needed for coord_polar and such            newdata <- rbind(newdata, newdata[1,])            ggplot2:::ggname("geom_flat_violin", GeomPolygon$draw_panel(newdata, panel_scales, coord))          },          draw_key = draw_key_polygon,          default_aes = aes(weight = 1, colour = "grey20", fill = "white", size = 0.5,                            alpha = NA, linetype = "solid"),          required_aes = c("x", "y"))#gg_data %>% dplyr::filter(diff == "F5-F4") %>% ggplot(aes(x= tea, y= temperature, fill=tea,color=tea))+    geom_flat_violin(position= position_nudge(x=.25)) +     geom_jitter(width = .1 )+    geom_boxplot(width = .1, position= position_nudge(x=.25), fill="white",size=.5,color="black") +     theme_bw() +  my.theme +    scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    scale_fill_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +    labs(title = "Temperature Difference of Finger F5-F4 ")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524140914.png" alt=""></p><h2 id="Lineplot"><a href="#Lineplot" class="headerlink" title="Lineplot"></a>Lineplot</h2><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144155.png" alt="">****</p><pre class=" language-R"><code class="language-R">gg_data_1 <- read_csv("c:/Users/TAOTAO/Desktop/R.Code/Always/LinePlot.csv")gg_data_1 %>%             ggplot(aes(y=tem_scaled,x=part, color=tea, shape=tea))+                geom_point(size = 4,alpha=.8) +                 theme_bw() +                 scale_color_manual(values = c("#3d3b4f",'#4c8dae','#2edfa3','#dc3023','#b0a4e3','#f2be45','#3eede7')) +        geom_line(data=gg_data_1[which(gg_data_1$group_1=="R"),],                 aes(group=factor(JingLuo), linetype= factor(Jingluo)), size=1.4,alpha = .6) +      geom_line(data=gg_data_1[which(gg_data_1$group_1=="L"),],                 aes(group=factor(JingLuo), linetype= factor(Jingluo)), size=1.4,alpha = .6) </code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141154.png" alt=""></p><pre class=" language-R"><code class="language-R">hehe %>%  ggplot(aes(x=number,y=value,color=variable)) +   geom_line(lwd=2) +  #,linetype = "dashed"  theme_bw() + scale_color_npg() +  scale_x_continuous(breaks = POG.df$number,labels = POG.df$gene.rank)+  scale_y_continuous(breaks = c(0.2,0.4,0.6,0.7,0.8,0.85,0.9,0.95),                     labels = c(0.2,0.4,0.6,0.7,0.8,0.85,0.9,0.95))+  theme(axis.text.x = element_text(angle = 30,vjust = 0.4))+  xlab("Gene ranking")+  ylab("Percentage of Overlapped Genes")  #geom_point(position = position_dodge(.2), size = 2)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141236.png" alt=""></p><pre class=" language-R"><code class="language-R">tmp %>% dplyr::filter(type=="A") %>% ggplot(aes(x = variable,y=value,fill=Percentile,color=Date)) +   geom_line(lwd=3) +   ylab("Mean Covrage")+  xlab("Normalized Position")+  theme_bw() + scale_color_nejm() +  theme(axis.title = element_text(size=25),        axis.text = element_text(size =25),        legend.text = element_text(size=20), #图例文字        legend.title = element_text(size=25,hjust = 0.5))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524141303.png" alt=""></p><h2 id="Scatter-plot"><a href="#Scatter-plot" class="headerlink" title="Scatter plot"></a>Scatter plot</h2><p>相关性矩阵图</p><pre class=" language-R"><code class="language-R">HEHE2 %>% pheatmap(show_rownames = T,           show_colnames = T,          cluster_rows = F,          cluster_cols = F,           display_numbers = TRUE,  #是否显示格子数值           number_color = "grey29",  #格子数值颜色           cutree_rows = 1,           cutree_cols = 1,           cellwidth = 45, cellheight = 45,           #annotation_col = col_anno,           #annotation_colors = ann_colors,          #annotation_row = col_anno,           border_color = F,   #调整格子边缘           main = paste0("Correlation Matrix of all Sample"),      #标题           fontsize=15                   #标题size           )</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144202.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144533.png" alt=""></p><h2 id="Paired-Scatter-Plot"><a href="#Paired-Scatter-Plot" class="headerlink" title="Paired Scatter Plot"></a>Paired Scatter Plot</h2><pre class=" language-R"><code class="language-R">library(GGally)panel.points <- function(data, mapping){  ggplot(data = data, mapping = mapping) +    geom_point(alpha=0.4,size=1.3,color='#177cb0')+ #3C5488FF    geom_abline(intercept = 0 , slope = 1 , color='#c93756', linetype='dashed', size=1)    #scale_x_continuous(limits=c(-7,17))+    #scale_y_continuous(limits=c(-7,17))}pn <- ggpairs(tmp2[7:ncol(tmp2)],mapping = ggplot2::aes(),  #title = paste0("Paired Scatter plot; ",i,"; ",format," 3000 genes"),  lower = list(continuous = panel.points),  #diag = list(continuous='barDiag'),  upper = list(    continuous = function(data, mapping, ...){    ggally_cor(data = data, mapping = mapping, size= 10)}    ) ) +  theme_light() +  theme(legend.position = "none",         panel.grid.major = element_blank(),         axis.ticks = element_blank(),         strip.text = element_text(size =20), #调节小面标签大小        axis.text = element_text(size =15), #调节坐标轴字体大小        panel.border = element_rect(colour = "black", fill = NA))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144046.png" alt=""></p><h2 id="Density-plot"><a href="#Density-plot" class="headerlink" title="Density plot"></a>Density plot</h2><pre class=" language-R"><code class="language-R">tmptmp %>%     ggplot(aes(x=value,fill=Sample_library,color=Sample_library)) +       geom_density(alpha=0.3,size=1.2) +       theme_bw() + scale_fill_nejm() + scale_color_nejm()+        labs(title = "Globle gene expression level",x= "log2 TPM")</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144111.png" alt=""></p><h2 id="VeenDiagram"><a href="#VeenDiagram" class="headerlink" title="VeenDiagram"></a>VeenDiagram</h2><pre class=" language-R"><code class="language-R">library (VennDiagram)venn.diagram(x=list(AGR=top2000.AGR, NVS=top2000.NVS,WuXi=top2000.WuX_Poly,ARD=top2000.ARD_Poly),                "NT_Consensus_Diff_Platform.png", height = 2000, width = 2000,                resolution =900, imagetype="png",col="gray",               fill=c("#574266","#bddd22","#ff2d51","#3eede7"),                alpha=c(0.6, 0.6,0.6,0.6), lwd=0.5, cex=0.4, #lwd调节线条宽度,cex=0了文字就没有了，                                                                      #cex调节里面的标注大小               cat.dist=c(-0.07, -0.07, -0.05,-0.07),                cat.pos=c(100, 260, 0,150),cat.cex=0.45, cat.col="black", #cat.调节数据集名称，                                                                     #cat.col和.pos似乎也可有可无               rotation.degree=180)    #rotation.degree是旋转角度的意思，可有可无</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144105.png" alt=""></p><h2 id="PCA"><a href="#PCA" class="headerlink" title="PCA"></a>PCA</h2><pre class=" language-R"><code class="language-R"># PCA ---------------------------------------------------------------------tmp %>% tail()tmp2 <- tmp %>% dcast(gene~Single_ID) tmp2 %>% dim()#然后PCA作图展示结果pc.cr <- prcomp(t(log2(tmp2[,-1] + 0.01)),retx = TRUE)pc <- round(summary(pc.cr)$importance[2,],2) pca.result <- as.data.frame(pc.cr$x[,1:2])tmp1 <- tmp %>% dplyr::select(Single_ID,sample,library,year,project)hehe <- tmp1 %>% group_by(Single_ID,library,sample,project) %>% summarise() %>% as.data.frame()pca.result <- cbind(hehe,pca.result)pca.result %>% head()##PCA按照样本类型，建库策略分开pn <- ggplot(pca.result,aes(x=PC1,y=PC2,color=sample,shape=library))+      geom_point(size = 6,alpha=0.5) +       theme_bw() + scale_color_nejm() +      xlab(paste0("PC1  ",pc[1])) +      ylab(paste0("PC2  ",pc[2])) ### 3D pcalibrary(rgl)pca.result.3d <- as.data.frame(pc.cr$x[,1:3])pca.result.3d <- cbind(hehe,pca.result.3d)pca.result.3d %>% headscales::show_col(pal_nejm("default")(8))pca.result.3d$color <- "#BC3C29FF"pca.result.3d$color[pca.result.3d$sample == "B"] <- "#0072B5FF"pca.result.3d$color[pca.result.3d$library == "PolyA"] <- "#E18727FF"pca.result.3d$color[pca.result.3d$library == "Ribo"] <- "#20854EFF"within(pca.result.3d,plot3d(PC1,PC2,PC3,size=10,col = color))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144134.png" alt=""></p><h2 id="HCA"><a href="#HCA" class="headerlink" title="HCA"></a>HCA</h2><pre class=" language-R"><code class="language-R">sample[sample == "A"] <- "#BC3C29FF"  #红sample[sample == "B"] <- "#0072B5FF"library[library == "Ribo"] <- "#E18727FF"   #黄library[library == "PolyA"] <- "#20854EFF"  #绿color <-  data.frame(library,sample) %>% as.matrix()myclust <- function(x){hclust(x,method="average")}library("gplots")library("heatmap.plus")showpanel <- function(col){  image(z=matrix(1:100, ncol=1), col=col, xaxt="n", yaxt="n" )}showpanel(colorpanel(25,"#BC3C29FF","white","#0072B5FF"))heatmap.plus(as.matrix(center), col=colorpanel(15,"#0072B5FF","white","#BC3C29FF"),             labRow=F,labCol = F,             scale="none", hclustfun=myclust, ColSideColors=color,          key=F, symkey=FALSE, dendrogram=c("none"),          density.info="none", trace="none", cexRow=0.5)library(export)graph2png(file="hehe.png",width=7,height=7)require(graphics)hc <- hclust(dist(t(as.matrix(center))),"average")plot(hc,axes = F)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144116.png" alt=""></p><h2 id="火山图"><a href="#火山图" class="headerlink" title="火山图"></a>火山图</h2><pre class=" language-R"><code class="language-R"># 设置pvalue和logFC的阈值cut_off_pvalue = 0.05cut_off_logFC = 1# 根据阈值分别为上调基因设置‘up’，下调基因设置‘Down’，无差异设置‘Stable’，保存到change列data$change = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= cut_off_logFC,                      ifelse(data$log2.fc.> cut_off_logFC ,'Up','Down'),'Stable')# 作图data %>% ggplot(aes(x= log2.fc. ,y=-log10(qvalue),color = change)) +  geom_point(aes(size = Abundance),alpha = 0.5 ) +   labs(x = "log2 fold change", y = "-log10(qvalue) \n") +    xlim(-4,4) + ylim(0,8) +           geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8) +    geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8) +  theme_classic() +   scale_color_manual(values=c("#546de5", "#d2dae2","#ff4757"))</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200524144832.png" alt=""></p><h2 id="火山图2"><a href="#火山图2" class="headerlink" title="火山图2"></a>火山图2</h2><pre class=" language-R"><code class="language-R">data <- read.csv( "C:../asset/wuli.csv")data$Abundance <- (data$Y179.30 + data$Y179.40)/1000# 设置pvalue和logFC的阈值cut_off_pvalue = 0.05cut_off_logFC = 1# 根据阈值分别为上调基因设置‘up’，下调基因设置‘Down’，无差异设置‘Stable’，保存到change列data$change = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= cut_off_logFC,                      ifelse(data$log2.fc.> cut_off_logFC ,'Up','Down'),'Stable')# 作图pn <- data %>% ggplot(aes(x= log2.fc. ,y=-log10(qvalue),color = change)) +  geom_point(aes(size = Abundance),alpha = 0.5 ) +   labs(x = "log2 fold change", y = "-log10(qvalue) \n") +    xlim(-4,4) + ylim(0,8) +           geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8) +    geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8) +  theme_classic() +   scale_color_manual(values=c("#546de5", "#d2dae2","#ff4757"))# 标记labeldata$label = ifelse(data$qvalue < cut_off_pvalue & abs(data$log2.fc.) >= 2.5,                        as.character(data$Geneid),"")library(ggrepel)pn + geom_text_repel(data = data, aes(x = data$log2.fc.,                                       y = -log10(data$qvalue),                                       label = label),                  size = 3,box.padding = unit(0.5, "lines"),                  point.padding = unit(0.8, "lines"),                   segment.color = "black",                   show.legend = FALSE)</code></pre><p><img src="https://raw.githubusercontent.com/Castel-Tao/Picbed_PicGo/master/img/20200531165613.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/06/10/hello-world/"/>
      <url>/2020/06/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
